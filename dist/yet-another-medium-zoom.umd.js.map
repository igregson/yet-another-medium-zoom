{"version":3,"file":"yet-another-medium-zoom.umd.js","sources":["../src/types.ts","../src/dom.ts","../src/flip.ts","../node_modules/style-inject/dist/style-inject.es.js","../src/core.ts","../src/caption/caption.ts","../src/album/album.ts","../src/swipe/detector.ts","../src/swipe/swipe.ts","../src/index.ts"],"sourcesContent":["import { MediumLightboxCore } from \"./core\";\n\nexport interface GlobalOptions {\n    scrollAllowance: number;\n    duration: number;\n    container?: HTMLElement;\n    lightboxGenerator?: (\n        $img: HTMLElement,\n        opts: ImageOptions,\n        $original: HTMLElement\n    ) => HTMLElement;\n}\n\nexport interface ImageOptions extends Partial<GlobalOptions> {\n    highres?: string;\n    class?: string;\n}\n\nexport interface YamzElement extends HTMLElement {\n    yamzOpts?: ImageOptions;\n}\n\nexport enum Classes {\n    WRAPPER = \"yamz__wrapper\",\n    WRAPPER_CLOSING = \"yamz__wrapper--closing\",\n    IMG_WRAPPER = \"yamz__img-wrapper\",\n    IMG = \"yamz__img\",\n    HIGHRES = \"yamz__highres\",\n    HAS_HIGHRES = \"yamz__wrapper--has-highres\",\n    HIGHRES_LOADED = \"yamz__wrapper--highres-loaded\",\n    CAPTION = \"yamz__caption\",\n    HAS_CAPTION = \"yamz__wrapper--has-caption\",\n    ORIGINAL = \"yamz__original\",\n    ORIGINAL_OPEN = \"yamz__original--open\",\n    LOADER = \"yamz__loader\",\n    ALBUM_PREV = \"yamz__album__prev\",\n    ALBUM_NEXT = \"yamz__album__next\",\n}\n\nexport enum STATES {\n    Closed,\n    Opening,\n    Open,\n    Closing,\n}\n\n// utility types\n// https://github.com/piotrwitek/utility-types/blob/ba66c895c7e52263268d179c142088f3e245a033/src/mapped-types.ts#L283-L296\nexport type Subtract<T extends object, U extends object> = Pick<T, Exclude<keyof T, keyof U>>;\ntype Overwrite<T extends object, U extends object> = Subtract<T, U> & U;\n/**\n * Applies a given Plugin, with its own GlobalOptions and ImageOptions, to an instance of YAMZ\n */\nexport type YamzPlugin<\n    Yamz extends MediumLightboxCore,\n    Plugin extends object,\n    NewGlobalOpts extends object,\n    NewImageOpts extends object\n> = Overwrite<\n    Yamz,\n    Overwrite<\n        {\n            defaultLightboxGenerator: (\n                $copiedImg: HTMLElement,\n                opts: Parameters<Yamz[\"defaultLightboxGenerator\"]>[1] & NewImageOpts,\n                $original: HTMLElement\n            ) => HTMLElement;\n            setOptions: (\n                options: Parameters<Yamz[\"setOptions\"]>[0] & Partial<NewGlobalOpts>\n            ) => ReturnType<Yamz[\"setOptions\"]>;\n            optsFromElm: ($elm: HTMLElement) => ReturnType<Yamz[\"optsFromElm\"]> & NewImageOpts;\n            open: (\n                $img: Parameters<Yamz[\"open\"]>[0],\n                opts?: Parameters<Yamz[\"open\"]>[1] & NewImageOpts\n            ) => ReturnType<Yamz[\"open\"]>;\n            replace: (\n                $img: Parameters<Yamz[\"replace\"]>[0],\n                opts?: Parameters<Yamz[\"replace\"]>[1] & NewImageOpts\n            ) => ReturnType<Yamz[\"replace\"]>;\n            bind: (\n                $imgs: Parameters<Yamz[\"bind\"]>[0],\n                opts?: Parameters<Yamz[\"bind\"]>[1] & NewImageOpts\n            ) => ReturnType<Yamz[\"bind\"]>;\n            options: Yamz[\"options\"] & NewGlobalOpts;\n        },\n        Plugin\n    >\n>;\n","import { ImageOptions, Classes } from \"./types\";\n\n/**\n * Creates an image for use in the lightbox based on an input element.\n * Always returns an <img>, regardless of the input element.\n */\nexport function generateLightboxImg(\n    $img: HTMLPictureElement | HTMLImageElement,\n    newSrc?: string\n): HTMLImageElement {\n    const $newImg = document.createElement(\"img\");\n    const src = newSrc ? newSrc : getSrcFromImage($img);\n    $newImg.src = src;\n\n    return $newImg;\n}\n\nexport function isValidImage($elm: HTMLElement): $elm is HTMLImageElement | HTMLPictureElement {\n    const types = [HTMLPictureElement, HTMLImageElement];\n    return types.some(type => $elm instanceof type);\n}\n\nexport function getHighResFromImage(\n    $image: HTMLImageElement | HTMLPictureElement,\n    targetWidth = document.body.clientWidth\n): string {\n    let cur = { width: $image.offsetWidth, src: getSrcFromImage($image) };\n    const $targets =\n        $image instanceof HTMLImageElement\n            ? [$image]\n            : Array.from($image.querySelectorAll(\"source\"));\n    $targets.forEach(($target: HTMLImageElement | HTMLSourceElement) => {\n        // ignore sources that don't match\n        if (\n            $target instanceof HTMLSourceElement &&\n            $target.media &&\n            !matchMedia($target.media).matches\n        ) {\n            return;\n        }\n        // extract size and URL from srcset\n        if (!$target.srcset) {\n            return;\n        }\n        const srcset = $target.srcset;\n        const parsed = getHighestFromSrcSet(srcset, targetWidth);\n        if (parsed && parsed.width > cur.width) {\n            cur = parsed;\n        }\n    });\n    return cur.src;\n}\n\nexport function getHighestFromSrcSet(srcset: string, targetWidth = document.body.clientWidth) {\n    const parsed = srcset.split(\",\").map(entry => {\n        const widthMatch = /([^ ]+) +(\\d+)w$/.exec(entry.trim());\n        if (!widthMatch) {\n            return null;\n        }\n        return {\n            src: widthMatch[1],\n            width: +widthMatch[2],\n        };\n    });\n\n    return parsed.reduce((prev, entry) => {\n        if (!entry) {\n            return prev;\n        }\n        if (!prev) {\n            return entry;\n        }\n        // if we've already found a smaller image that is bigger than the screen, use that image instead\n        if (entry.width > prev.width && prev.width >= targetWidth) {\n            return prev;\n        }\n        // if the one we've found is smaller than the previously found, only use it if it's bigger than targetWidth\n        if (entry.width < prev.width && entry.width < targetWidth) {\n            return prev;\n        }\n        return entry;\n    }, null);\n}\n\nexport function getSrcFromImage($elm: HTMLImageElement | HTMLPictureElement): string {\n    if ($elm instanceof HTMLImageElement) {\n        return $elm.currentSrc || /* IE11 support */ $elm.src;\n    }\n    if ($elm instanceof HTMLPictureElement) {\n        const $img = $elm.querySelector(\"img\");\n        if ($img) {\n            return $img.currentSrc || /* IE11 support */ $img.src;\n        }\n    }\n    return \"\";\n}\n\nexport function getScrollPosition(horizontal: boolean = false): number {\n    return horizontal\n        ? window.scrollX || document.body.scrollLeft || document.documentElement.scrollLeft || 0\n        : window.scrollY || document.body.scrollTop || document.documentElement.scrollTop || 0;\n}\n\nexport function defaultLightboxGenerator(\n    $copiedImg: HTMLElement,\n    opts: ImageOptions,\n    $original: HTMLElement\n) {\n    const $wrapper = document.createElement(\"aside\");\n    $wrapper.classList.add(Classes.WRAPPER);\n    if (opts.class) {\n        $wrapper.classList.add(opts.class);\n    }\n\n    const $imgWrapper = document.createElement(\"div\");\n    $imgWrapper.classList.add(Classes.IMG_WRAPPER);\n    $imgWrapper.appendChild($copiedImg);\n    $wrapper.appendChild($imgWrapper);\n\n    // add loading UI if we're going to load a highres\n    if (opts.highres) {\n        $wrapper.classList.add(Classes.HAS_HIGHRES);\n        const $loader = document.createElement(\"div\");\n        $loader.classList.add(Classes.LOADER);\n        $imgWrapper.insertBefore($loader, $copiedImg);\n    }\n\n    return $wrapper;\n}\n","import { getScrollPosition } from \"./dom\";\n\n/** Used to make sure a single element never has two animations at a time */\nconst elmMap: Map<HTMLElement, FLIPElement> = new Map();\n\n/** https://aerotwist.com/blog/flip-your-animations/ */\nexport default class FLIPElement {\n    $elm: HTMLElement;\n    playing: boolean = false;\n    _first?: Snapshot;\n    _last?: Snapshot;\n    _elmPos?: Snapshot;\n    _target$Elm?: HTMLElement;\n    _playResolver?: (val?: unknown) => void;\n    _transitionFallback?: number;\n\n    constructor($elm: HTMLElement) {\n        this.$elm = $elm;\n\n        if (elmMap.has($elm)) {\n            const self = elmMap.get($elm);\n            if (self) {\n                return self;\n            }\n        }\n\n        elmMap.set($elm, this);\n        this._onTransitionEnd = this._onTransitionEnd.bind(this);\n        this.stop = this.stop.bind(this);\n    }\n\n    first($elm: HTMLElement = this.$elm) {\n        if (this.playing) {\n            this.stop();\n        }\n\n        this._first = getSnapshot($elm);\n        return this;\n    }\n\n    last($elm: HTMLElement = this.$elm) {\n        if (this.playing) {\n            this.stop();\n        }\n\n        this._last = getSnapshot($elm);\n        return this;\n    }\n\n    invert($elm: HTMLElement = this.$elm) {\n        if (!this._first || !this._last) {\n            throw new Error(\".first() and .last() must be called before .invert()\");\n        }\n\n        this._elmPos = getSnapshot($elm);\n        $elm.style.transitionDuration = \"0s\";\n        $elm.style.transformOrigin = \"50% 50%\";\n        $elm.style.transform = getTransform(this._elmPos, this._first);\n\n        this._target$Elm = $elm;\n        return this;\n    }\n\n    play(duration = 300) {\n        if (!this._target$Elm || !this._elmPos || !this._first || !this._last) {\n            throw new Error(\".invert() must be called before .play()\");\n        }\n        if (this.playing) {\n            this.stop();\n        }\n        this.playing = true;\n\n        const $elm = this._target$Elm;\n        +$elm.offsetHeight; // force reflow\n        $elm.style.transitionDuration = `${duration}ms`;\n        $elm.style.transform = getTransform(this._elmPos, this._last);\n\n        $elm.addEventListener(\"transitioncancel\", this._onTransitionEnd);\n        $elm.addEventListener(\"transitionend\", this._onTransitionEnd);\n        clearTimeout(this._transitionFallback);\n        this._transitionFallback = (setTimeout(this.stop, duration + 50) as unknown) as number;\n\n        return new Promise((res, rej) => {\n            this._playResolver = res;\n        });\n    }\n\n    stop() {\n        clearTimeout(this._transitionFallback);\n        if (this._target$Elm) {\n            this._target$Elm.removeEventListener(\"transitioncancel\", this._onTransitionEnd);\n            this._target$Elm.removeEventListener(\"transitionend\", this._onTransitionEnd);\n        }\n        if (this._playResolver) {\n            this._playResolver();\n            this._playResolver = undefined;\n        }\n        this.playing = false;\n        this._target$Elm = undefined;\n    }\n\n    /** Updates an animation while it's playing */\n    update($target: HTMLElement, updater?: () => void, duration?: number) {\n        const $elm = this._target$Elm;\n        if (!this.playing || !$elm || !this._first) {\n            return;\n        }\n\n        const currentPos = getTransformedSnapshot($elm);\n        if (updater) {\n            updater();\n        }\n        this._elmPos = getSnapshot($elm);\n        this._last = getSnapshot($target);\n        const prevDuration = duration ? `${duration}ms` : $elm.style.transitionDuration;\n        $elm.style.transitionDuration = `0ms`;\n        $elm.style.transform = getTransform(this._elmPos, currentPos);\n        +$elm.offsetHeight; // force reflow\n        $elm.style.transitionDuration = prevDuration;\n        $elm.style.transform = getTransform(this._elmPos, this._last);\n    }\n\n    _onTransitionEnd(e: TransitionEvent) {\n        if (e.target === this._target$Elm && e.propertyName === \"transform\") {\n            this.stop();\n        }\n    }\n}\n\ninterface Snapshot {\n    left: number;\n    top: number;\n    width: number;\n    height: number;\n}\n\nexport function getSnapshot($elm: HTMLElement): Snapshot {\n    const outp = {\n        width: $elm.offsetWidth,\n        height: $elm.offsetHeight,\n        left: $elm.offsetLeft,\n        top: $elm.offsetTop,\n    };\n\n    // make sure left/top is measured from center\n    // this allows us to combine scaling and translating\n    outp.left += outp.width / 2;\n    outp.top += outp.height / 2;\n\n    // offsetLeft/Top relates to offsetParent. Walk up the tree to get it relative to the window\n    while (\n        $elm.offsetParent instanceof HTMLElement &&\n        $elm.offsetParent &&\n        $elm.offsetParent !== document.body &&\n        $elm.offsetParent !== document.documentElement\n    ) {\n        $elm = $elm.offsetParent;\n        outp.left += $elm.offsetLeft;\n        outp.top += $elm.offsetTop;\n    }\n\n    // if the element is fixed, offsetLeft/Top will be 0 when we want it to be the scroll position\n    if (\n        $elm.offsetTop === 0 &&\n        $elm.offsetLeft === 0 &&\n        window.getComputedStyle($elm).position === \"fixed\"\n    ) {\n        const $doc = document.documentElement;\n        outp.left += getScrollPosition(true) - ($doc.clientLeft || 0);\n        outp.top += getScrollPosition() - ($doc.clientTop || 0);\n    }\n\n    return outp;\n}\n\n/** Gets the snapshot of an element, but doesn't ignore transforms (unlike getSnapshot) */\nfunction getTransformedSnapshot($elm: HTMLElement): Snapshot {\n    const boundingRect = $elm.getBoundingClientRect();\n    const $doc = document.documentElement;\n    const outp = {\n        left: Math.round(boundingRect.left) + getScrollPosition(true) - ($doc.clientLeft || 0),\n        top: Math.round(boundingRect.top) + getScrollPosition() - ($doc.clientTop || 0),\n        width: Math.round(boundingRect.width),\n        height: Math.round(boundingRect.height),\n    };\n    outp.left += outp.width / 2;\n    outp.top += outp.height / 2;\n    return outp;\n}\n\nfunction getTransform(from: Snapshot, to: Snapshot) {\n    const delta = {\n        left: to.left - from.left,\n        top: to.top - from.top,\n        width: to.width / from.width,\n        height: to.height / from.height,\n    };\n\n    const translation = `translate(${delta.left.toFixed(5)}px, ${delta.top.toFixed(5)}px)`;\n    const scaling = `scale(${delta.width.toFixed(5)}, ${delta.height.toFixed(5)})`;\n    return `${translation} ${scaling}`;\n}\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import { ImageOptions, GlobalOptions, Classes, STATES, YamzElement } from \"./types\";\nimport {\n    defaultLightboxGenerator,\n    isValidImage,\n    getSrcFromImage,\n    getHighResFromImage,\n    generateLightboxImg,\n    getScrollPosition,\n} from \"./dom\";\nimport FLIPElement from \"./flip\";\nimport \"./style.css\";\n\nexport const DEFAULT_OPTS: GlobalOptions = {\n    scrollAllowance: 128,\n    duration: 300,\n    container: undefined,\n    lightboxGenerator: undefined,\n};\n\nexport class MediumLightboxCore {\n    options: GlobalOptions = {\n        ...DEFAULT_OPTS,\n    };\n    state: STATES = STATES.Closed;\n    active?: {\n        $lightbox: HTMLElement;\n        $img: HTMLElement;\n        $copiedImg: HTMLImageElement;\n        $highRes?: HTMLImageElement;\n        scrollPos: number;\n        origSrc?: string;\n        options: ImageOptions;\n    } = undefined;\n    _flip?: FLIPElement;\n\n    _raf: boolean = false;\n\n    constructor() {\n        this._onScroll = this._onScroll.bind(this);\n        this._onKeyDown = this._onKeyDown.bind(this);\n    }\n\n    /** Set options used by every lightbox */\n    setOptions(newOpts: Partial<GlobalOptions>) {\n        this.options = {\n            ...this.options,\n            ...newOpts,\n        };\n    }\n    /** Get the currently set global options */\n    getOptions() {\n        return this.options;\n    }\n\n    /** Open a specific image in the lightbox */\n    async open($img: YamzElement, opts?: ImageOptions): Promise<HTMLElement> {\n        if (!isValidImage($img)) {\n            throw new TypeError(`${$img} cannot be used as an image`);\n        }\n        if (this.active) {\n            await this.close();\n        }\n\n        const options = {\n            ...this.options,\n            ...($img.yamzOpts || {}),\n            ...(opts || {}),\n        };\n\n        // generate our lightbox\n        this.state = STATES.Opening;\n        this.active = {\n            ...this.generateLightbox($img, options),\n            options,\n            scrollPos: getScrollPosition(),\n        };\n\n        // then insert and animate it\n        (options.container || document.body).appendChild(this.active.$lightbox);\n        this.active.$lightbox.style.top = `${this.active.scrollPos}px`;\n        const $animElm = this.active.$copiedImg.parentElement || this.active.$copiedImg;\n        let $positionElm = $img.nodeName === \"PICTURE\" ? $img.querySelector(\"img\") : $img;\n        if (!$positionElm) {\n            $positionElm = $img;\n        }\n        if (options.duration > 0) {\n            this._flip = new FLIPElement($img);\n            await this._flip\n                .first($positionElm)\n                .last(this.active.$copiedImg)\n                .invert($animElm)\n                .play(options.duration);\n        }\n        this.state = STATES.Open;\n\n        this.attachListeners();\n\n        return this.active.$lightbox;\n    }\n\n    /** Close the currently active image. If img is given, only closes if that's the currently active img */\n    async close($img?: YamzElement): Promise<void> {\n        if (!this.active) {\n            return;\n        }\n        if ($img && this.active.$img !== $img) {\n            return;\n        }\n        if (!$img) {\n            $img = this.active.$img;\n        }\n\n        this.detachListeners();\n\n        this.state = STATES.Closing;\n        const active = this.active; // we store this for later in case .active is updated while we're animating the close\n        const options = active.options;\n        this.active.$lightbox.classList.add(Classes.WRAPPER_CLOSING);\n        const $animElm = this.active.$copiedImg.parentElement || this.active.$copiedImg;\n        let $positionElm =\n            this.active.$img.nodeName === \"PICTURE\" ? this.active.$img.querySelector(\"img\") : $img;\n        if (!$positionElm) {\n            $positionElm = this.active.$img;\n        }\n        if (options.duration) {\n            const flip = new FLIPElement($img);\n            flip.first(this.active.$copiedImg).last($positionElm);\n\n            await flip.invert($animElm).play(options.duration);\n        }\n        active.$img.classList.remove(Classes.ORIGINAL_OPEN);\n        const $parent = active.$lightbox.parentNode;\n        if ($parent) {\n            $parent.removeChild(active.$lightbox);\n        }\n        this.state = STATES.Closed;\n\n        if (this.active === active) {\n            this.active = undefined;\n        }\n    }\n\n    /**\n     * Replaces the currently open lightbox with that of another image, without animating a close/open\n     */\n    replace($img: YamzElement, opts?: ImageOptions) {\n        if (!isValidImage($img)) {\n            throw new TypeError(`${$img} cannot be used as an image`);\n        }\n        if (!this.active) {\n            return;\n        }\n\n        // unhide the original image\n        this.active.$img.classList.remove(Classes.ORIGINAL_OPEN);\n\n        // then generate the new lightbox and set it as active\n        const $oldLightbox = this.active.$lightbox;\n        const nextOpts = {\n            ...this.options,\n            ...($img.yamzOpts || {}),\n            ...(opts || {}),\n        };\n        const nextActive = this.generateLightbox($img, nextOpts);\n        this.active = {\n            ...this.active,\n            ...nextActive,\n            $lightbox: $oldLightbox,\n            options: nextOpts,\n        };\n\n        // then update the DOM\n        this.replaceLightboxDOM(nextActive.$lightbox, $oldLightbox);\n    }\n\n    /**\n     * Replaces the currently active lightbox DOM with the given one\n     * Mostly its own method so plugins can overwrite it\n     */\n    replaceLightboxDOM($newLightbox: HTMLElement, $oldLightbox?: HTMLElement) {\n        if (!$oldLightbox) {\n            $oldLightbox = this.active && this.active.$lightbox;\n        }\n        if (!$oldLightbox) {\n            return;\n        }\n\n        /**\n         * We replace the content of the lightbox instead of just replacing the element itself because the open\n         * animations (e.g. fade-in of background) are CSS animations, that would replay if a new lightbox was inserted\n         * TODO: consider whether this approach is better than having a CSS class that disables open animation\n         */\n\n        // replace the content of the current lightbox with that of the target lightbox\n        while ($oldLightbox.firstChild) {\n            $oldLightbox.removeChild($oldLightbox.firstChild);\n        }\n        const $children = Array.from($newLightbox.children);\n        for (let i = 0; i < $children.length; ++i) {\n            $oldLightbox.appendChild($children[i]);\n        }\n\n        // update the lightbox's attributes to match the new one\n        $oldLightbox.setAttribute(\"class\", $newLightbox.className);\n    }\n\n    /**\n     * Function for generating lightbox for a given image.\n     * This also handles loading the highres and stuff.\n     * If you're only looking for generating the DOM (e.g. if you're creating a custom lightbox generator), use .defaultLightboxGenerator\n     */\n    generateLightbox(\n        $img: HTMLPictureElement | HTMLImageElement,\n        opts: GlobalOptions & ImageOptions\n    ): {\n        $img: HTMLPictureElement | HTMLImageElement;\n        $copiedImg: HTMLImageElement;\n        $lightbox: HTMLElement;\n        origSrc: string;\n        $highRes?: HTMLImageElement;\n    } {\n        const generator = opts.lightboxGenerator || this.defaultLightboxGenerator;\n        const origSrc = getSrcFromImage($img);\n        const hasSrcSet = $img instanceof HTMLPictureElement || $img.srcset;\n\n        // if we weren't explicitly given a highres, try to extract one from the image\n        if (!opts.highres && hasSrcSet) {\n            const highRes = getHighResFromImage($img);\n            opts.highres = highRes;\n        }\n\n        // generate the DOM\n        const $copiedImg = generateLightboxImg($img);\n        $copiedImg.classList.add(Classes.IMG);\n        $copiedImg.classList.remove(Classes.ORIGINAL);\n        $img.classList.add(Classes.ORIGINAL_OPEN);\n        const $lightbox = generator.call(this, $copiedImg, opts, $img);\n\n        // add event listeners\n        $lightbox.addEventListener(\"click\", () => this.close());\n\n        // and start loading high-res if we need to\n        // start loading the highres version if we have one\n        let $highRes: HTMLImageElement | undefined;\n        if (opts.highres) {\n            $highRes = new Image();\n            $highRes.decoding = \"async\";\n            $highRes.addEventListener(\"load\", () => {\n                if (this.active && this.active.$img === $img) {\n                    this._highResLoaded($highRes as HTMLImageElement);\n                }\n            });\n            $highRes.addEventListener(\"error\", e => {\n                console.error(`High-res image failed to load`, e);\n                $lightbox.classList.remove(Classes.HAS_HIGHRES);\n                const $loader = $lightbox.querySelector(`.${Classes.LOADER}`);\n                if ($loader && $loader.parentNode) {\n                    $loader.parentNode.removeChild($loader);\n                }\n            });\n            $highRes.src = opts.highres;\n            $highRes.classList.add(Classes.HIGHRES);\n        }\n\n        return {\n            $img,\n            $copiedImg,\n            $lightbox,\n            origSrc,\n            $highRes,\n        };\n    }\n\n    /** Called when a high-res version of an image has loaded */\n    _highResLoaded($highRes: HTMLImageElement) {\n        if (!this.active) {\n            return;\n        }\n        const $copiedImg = this.active.$copiedImg;\n        const $animElm = $copiedImg.parentElement || $copiedImg;\n\n        // function that inserts the highres, resizing the img wrapper to the size of the highres\n        const updater = () => {\n            if (!this.active) {\n                return;\n            }\n            if ($copiedImg.parentElement) {\n                this.active.$highRes = $highRes;\n                this.active.$lightbox.classList.add(Classes.HIGHRES_LOADED);\n                $copiedImg.parentElement.insertBefore(\n                    $highRes,\n                    $copiedImg.parentElement.firstChild\n                );\n            }\n        };\n\n        if (this.state === STATES.Opening && this._flip) {\n            this._flip.update($animElm, updater, this.active.options.duration);\n        } else if (this.state === STATES.Open && this.active) {\n            this._flip = new FLIPElement(this.active.$img);\n            this._flip.first(this.active.$copiedImg);\n            updater();\n            this._flip\n                .last(this.active.$copiedImg)\n                .invert($animElm)\n                .play(this.active.options.duration);\n        } else {\n            updater();\n        }\n    }\n\n    /** Parses options from a DOM element */\n    optsFromElm($elm: HTMLElement): ImageOptions {\n        const outp: ImageOptions = {};\n\n        if ($elm.dataset.class) {\n            outp.class = $elm.dataset.class;\n        }\n        if ($elm.dataset.highres) {\n            outp.highres = $elm.dataset.highres;\n        }\n        if ($elm.dataset.duration && !Number.isNaN(+$elm.dataset.duration)) {\n            outp.duration = +$elm.dataset.duration;\n        }\n        if ($elm.dataset.scrollAllowance && !Number.isNaN(+$elm.dataset.scrollAllowance)) {\n            outp.scrollAllowance = +$elm.dataset.scrollAllowance;\n        }\n\n        return outp;\n    }\n\n    /** Binds an image (or multiple), such that clicking it will open it\n     * @param $imgs The image(s) to bind. If this is a string, it's used as a selector. */\n    bind($imgs: HTMLElement | HTMLElement[] | string, opts?: ImageOptions): void {\n        if (typeof $imgs === \"string\") {\n            $imgs = Array.from(document.querySelectorAll($imgs));\n        }\n        if (!($imgs instanceof Array)) {\n            $imgs = [$imgs];\n        }\n\n        $imgs.forEach($img => {\n            $img.addEventListener(\"click\", () => {\n                // we extract options from the DOM here so that developers can change the data attributes and have it reflected\n                const imgOpts = {\n                    ...this.optsFromElm($img),\n                    ...(opts || {}),\n                };\n                this.open($img, imgOpts);\n            });\n            $img.classList.add(Classes.ORIGINAL);\n\n            // we store the custom opts given to us so we can later recreate the lightbox just from the element\n            if (opts) {\n                ($img as YamzElement).yamzOpts = opts;\n            }\n        });\n    }\n\n    /** Attaches listeners we need globally */\n    attachListeners() {\n        window.addEventListener(\"scroll\", this._onScroll);\n        document.addEventListener(\"keydown\", this._onKeyDown);\n    }\n\n    /** Detaches global listeners */\n    detachListeners() {\n        window.removeEventListener(\"scroll\", this._onScroll);\n        document.removeEventListener(\"keydown\", this._onKeyDown);\n    }\n\n    /** Helper function used as scroll listener. Debounces calls to .onScroll */\n    _onScroll(): void {\n        if (this._raf) {\n            return;\n        }\n        this._raf = true;\n        setTimeout(() => {\n            this._raf = false;\n            this.onScroll();\n        }, 60);\n    }\n    onScroll(): void {\n        if (!this.active) {\n            return;\n        }\n        if (\n            this.active.options.scrollAllowance === undefined ||\n            this.active.options.scrollAllowance < 0\n        ) {\n            return;\n        }\n        const scrollAllowance = this.active.options.scrollAllowance;\n        const scrollPos = getScrollPosition();\n        const delta = Math.abs(this.active.scrollPos - scrollPos);\n\n        if (delta > scrollAllowance) {\n            this.close();\n        }\n    }\n\n    /** Helper function used to ensure that .onKeyDown is called with proper `this` value, even if overwritten by plugins */\n    _onKeyDown(e: KeyboardEvent) {\n        this.onKeyDown(e);\n    }\n    onKeyDown(e: KeyboardEvent) {\n        if (!this.active) {\n            return;\n        }\n        if (e.key === \"Escape\") {\n            this.close();\n        }\n    }\n\n    // re-export some stuff so it's easily available to plugins\n    defaultLightboxGenerator = defaultLightboxGenerator;\n}\n\nexport default new MediumLightboxCore();\n","import { MediumLightboxCore } from \"../core\";\nimport { Classes, YamzPlugin } from \"../types\";\nimport \"./caption.css\";\n\nexport interface Captioned {}\n\nexport interface CaptionOptions {\n    caption?: string | HTMLElement;\n}\n\n/** Augments the YAMZ instance to support captions */\nexport default function withCaption<YamzType extends MediumLightboxCore>(_yamz: YamzType) {\n    const { defaultLightboxGenerator, optsFromElm } = _yamz;\n    const yamz = _yamz as YamzPlugin<YamzType, Captioned, CaptionOptions, CaptionOptions>;\n\n    // insert caption into the lightbox if we're given one\n    yamz.defaultLightboxGenerator = function($copiedImg, opts, $original) {\n        const $lightbox = defaultLightboxGenerator.call(this, $copiedImg, opts, $original);\n\n        // add caption if given\n        if (opts.caption) {\n            const $caption = document.createElement(\"div\");\n            $caption.classList.add(Classes.CAPTION);\n            if (opts.caption instanceof HTMLElement) {\n                $caption.appendChild(opts.caption);\n            } else {\n                $caption.textContent = opts.caption;\n            }\n            $lightbox.classList.add(Classes.HAS_CAPTION);\n            $lightbox.appendChild($caption);\n        }\n\n        return $lightbox;\n    };\n\n    // also allow specifying the caption in HTML\n    yamz.optsFromElm = function($elm: HTMLElement) {\n        type outpType = ReturnType<YamzType[\"optsFromElm\"]> & CaptionOptions;\n        const outp: outpType = optsFromElm.call(this, $elm) as outpType;\n        if ($elm.dataset.caption) {\n            outp.caption = $elm.dataset.caption;\n        }\n        return outp;\n    };\n\n    return yamz;\n}\n","import { MediumLightboxCore } from \"../core\";\nimport { Classes, YamzPlugin } from \"../types\";\nimport \"./album.css\";\n\nexport interface Albumed<Yamz extends MediumLightboxCore> {\n    moveToAlbumEntry: (entry: AlbumEntry<Yamz>, direction: \"next\" | \"prev\") => void;\n}\n\nexport interface AlbumOptions<Yamz extends MediumLightboxCore> {\n    album?: AlbumEntry<Yamz>[];\n    wrapAlbum?: boolean;\n}\n\nexport interface AlbumEntry<Yamz extends MediumLightboxCore> {\n    img: HTMLElement;\n    opts?: ReturnType<Yamz[\"optsFromElm\"]> & AlbumOptions<Yamz>;\n}\n\n/** Augments the YAMZ instance to support albums */\nexport default function withAlbum<YamzType extends MediumLightboxCore>(_yamz: YamzType) {\n    const { defaultLightboxGenerator, optsFromElm, onKeyDown } = _yamz;\n    const yamz = _yamz as YamzPlugin<\n        YamzType,\n        Albumed<YamzType>,\n        AlbumOptions<YamzType>,\n        AlbumOptions<YamzType>\n    >;\n\n    yamz.options = {\n        wrapAlbum: false,\n        ...yamz.options,\n    };\n\n    function augmentLightbox(\n        yamz: Albumed<YamzType>,\n        $lightbox: HTMLElement,\n        opts: AlbumOptions<YamzType>,\n        index: number\n    ) {\n        if (!opts.album) {\n            return $lightbox;\n        }\n        const prevIndex = opts.wrapAlbum\n            ? (opts.album.length + index - 1) % opts.album.length\n            : index - 1;\n        const nextIndex = opts.wrapAlbum\n            ? (opts.album.length + index + 1) % opts.album.length\n            : index + 1;\n\n        if (prevIndex >= 0) {\n            const $prev = document.createElement(\"button\");\n            $prev.classList.add(Classes.ALBUM_PREV);\n            $prev.addEventListener(\"click\", e => {\n                if (!opts.album) {\n                    return;\n                }\n                e.stopPropagation();\n                yamz.moveToAlbumEntry(opts.album[prevIndex], \"prev\");\n            });\n            $lightbox.appendChild($prev);\n        }\n        if (nextIndex < opts.album.length) {\n            const $next = document.createElement(\"button\");\n            $next.classList.add(Classes.ALBUM_NEXT);\n            $next.addEventListener(\"click\", e => {\n                if (!opts.album) {\n                    return;\n                }\n                e.stopPropagation();\n                yamz.moveToAlbumEntry(opts.album[nextIndex], \"next\");\n            });\n            $lightbox.appendChild($next);\n        }\n    }\n\n    // insert album stuff into the lightbox if we're given one\n    yamz.defaultLightboxGenerator = function($copiedImg, opts, $original) {\n        const $lightbox = defaultLightboxGenerator($copiedImg, opts, $original);\n\n        if (opts.album) {\n            const index = opts.album.findIndex(entry => entry.img === $original);\n            augmentLightbox(this, $lightbox, opts, index);\n        }\n\n        return $lightbox;\n    };\n\n    // also allow specifying the album in HTML\n    yamz.optsFromElm = function($elm: HTMLElement) {\n        type outpType = ReturnType<YamzType[\"optsFromElm\"]> & AlbumOptions<YamzType>;\n        const outp: outpType = optsFromElm($elm) as outpType;\n        if ($elm.dataset.album) {\n            const $siblings = Array.from(\n                document.querySelectorAll(`[data-album=\"${$elm.dataset.album}\"]`)\n            ) as HTMLElement[];\n            outp.album = $siblings.map($sibling => {\n                return {\n                    img: $sibling,\n                    opts: optsFromElm($sibling),\n                };\n            }) as AlbumEntry<YamzType>[];\n            // make sure each entry knows about which album it's in\n            outp.album.forEach(entry => {\n                entry.opts = {\n                    ...(entry.opts || {}),\n                    album: outp.album,\n                } as outpType;\n            });\n        }\n        return outp;\n    };\n\n    // add new method for moving to an album entry\n    yamz.moveToAlbumEntry = function(entry: AlbumEntry<YamzType>, direction: \"next\" | \"prev\") {\n        if (!this.active) {\n            return;\n        }\n        const $target = this.active.$lightbox.querySelector(\n            `.${Classes.IMG_WRAPPER}`\n        ) as HTMLElement;\n        if (!$target) {\n            throw new ReferenceError(\"Could not find image wrapper in lightbox\");\n        }\n        const directions = {\n            out: direction === \"next\" ? \"left\" : \"right\",\n            in: direction === \"next\" ? \"right\" : \"left\",\n        };\n        let replaced = false;\n        const _onAnimEnd = () => {\n            if (replaced || !this.active) {\n                return;\n            }\n            replaced = true;\n            this.replace(entry.img, entry.opts);\n            const $newTarget = this.active.$lightbox.querySelector(\n                `.${Classes.IMG_WRAPPER}`\n            ) as HTMLElement;\n            if (!$newTarget) {\n                return;\n            }\n            $newTarget.classList.add(`${Classes.IMG_WRAPPER}--in-${directions.in}`);\n        };\n\n        setTimeout(_onAnimEnd, 1000); // fail safe if for whatever reason animation doesn't play\n        $target.addEventListener(\"animationend\", _onAnimEnd);\n        $target.addEventListener(\"animationcancel\", _onAnimEnd);\n        $target.classList.add(`${Classes.IMG_WRAPPER}--out-${directions.out}`);\n    };\n\n    // finally extend the keyboard interactivity\n    yamz.onKeyDown = function(e: KeyboardEvent) {\n        onKeyDown.call(this, e);\n        if (!this.active) {\n            return;\n        }\n        const opts = this.active.options as AlbumOptions<YamzType>;\n        if (!opts.album) {\n            return;\n        }\n\n        // move back/forward in album when pressing arrow keys\n        if (e.key === \"ArrowLeft\" || e.key === \"ArrowRight\") {\n            const $curImg = this.active.$img;\n            const index = opts.album.findIndex(entry => entry.img === $curImg);\n            const prevIndex = opts.wrapAlbum\n                ? (opts.album.length + index - 1) % opts.album.length\n                : index - 1;\n            const nextIndex = opts.wrapAlbum\n                ? (opts.album.length + index + 1) % opts.album.length\n                : index + 1;\n            const targetIndex = e.key === \"ArrowLeft\" ? prevIndex : nextIndex;\n\n            if (targetIndex >= 0 && targetIndex < opts.album.length) {\n                (this as Albumed<YamzType>).moveToAlbumEntry(\n                    opts.album[targetIndex],\n                    e.key === \"ArrowLeft\" ? \"prev\" : \"next\"\n                );\n            }\n        }\n    };\n\n    return yamz;\n}\n","type coordinates = {\n    x: number;\n    y: number;\n};\ntype listeners = {\n    start?: (position: coordinates, metadata?: any) => void;\n    update?: (offset: coordinates, metadata?: any) => void;\n    end?: (direction: \"left\" | \"right\", metadata?: any) => void;\n    cancel?: (metadata?: any) => void;\n};\n\nexport default class SwipeDetector {\n    listeners: listeners;\n    state?: {\n        startTouch: coordinates & { time: number };\n        lastTouch: coordinates & { time: number };\n        identifier?: number;\n        velocity: number;\n        isSwipe: boolean;\n        metadata?: any;\n    };\n    threshold: number;\n\n    constructor(listeners: listeners, threshold: number = 0) {\n        this.listeners = listeners;\n        this.threshold = threshold;\n\n        // make sure we can be attached as event listeners easily\n        this.start = this.start.bind(this);\n        this.move = this.move.bind(this);\n        this.end = this.end.bind(this);\n        this.cancel = this.cancel.bind(this);\n    }\n    setThreshold(threshold: number) {\n        this.threshold = threshold;\n    }\n\n    start(e: MouseEvent | TouchEvent, metadata?: any) {\n        if (!(e instanceof MouseEvent)) {\n            // we ignore any start touches if another finger is currently down (and cancel any active ones if a new finger is touched)\n            if (e.touches.length > 1) {\n                this.cancel();\n                return false;\n            }\n        }\n        const touch = e instanceof MouseEvent ? e : e.touches[0];\n\n        const initialTouch = {\n            x: touch.clientX,\n            y: touch.clientY,\n            time: Date.now(),\n        };\n        this.state = {\n            startTouch: { ...initialTouch },\n            lastTouch: { ...initialTouch },\n            isSwipe: false,\n            velocity: 0,\n            identifier: touch instanceof MouseEvent ? undefined : touch.identifier,\n            metadata: metadata,\n        };\n\n        this.emit(\"start\", initialTouch, metadata);\n    }\n\n    move(e: MouseEvent | TouchEvent) {\n        if (!this.state) {\n            return;\n        } // ignore if we aren't currently dragging\n        let touch: MouseEvent | Touch | undefined = e instanceof MouseEvent ? e : undefined;\n        if (!(e instanceof MouseEvent)) {\n            for (let i = 0; i < e.changedTouches.length; ++i) {\n                const t = e.changedTouches[i];\n                if (t.identifier === this.state.identifier) {\n                    touch = t;\n                    break;\n                }\n            }\n        }\n        if (!touch) {\n            return;\n        } // ignore if none of the touches are the one we're tracking\n\n        const timeDelta = Date.now() - this.state.lastTouch.time;\n        if (timeDelta < 16) {\n            return;\n        } // debounce\n        // we compare the direction relative to the starting point; if it's more down than up, we cancel the drag ('cause it's probably a scroll)\n        const xDelta = touch.clientX - this.state.startTouch.x;\n        const yDelta = touch.clientY - this.state.startTouch.y;\n        const absXDelta = Math.abs(xDelta);\n        const absYDelta = Math.abs(yDelta);\n\n        // ignore ones where the mouse hasn't moved\n        if (absXDelta === 0 && absYDelta === 0) {\n            return;\n        }\n\n        // update our state\n        this.state.lastTouch.x = touch.clientX;\n        this.state.lastTouch.y = touch.clientY;\n        this.state.lastTouch.time = Date.now();\n        this.state.velocity = timeDelta ? (touch.clientX - this.state.lastTouch.x) / timeDelta : 0;\n\n        const IGNORE_THRESHOLD = 32; // ignore test if we have moved barely anything. Possibly consider if this is better as an option?\n        if (!this.state.isSwipe) {\n            // don't start tracking as a swipe until after we've exceeding our threshold\n            if (Math.max(absXDelta, absYDelta) < IGNORE_THRESHOLD) {\n                return;\n            } else {\n                // if we've just now gone past our threshold, check if this looks more like a scroll than a swipe\n                if (absYDelta > absXDelta) {\n                    this.cancel();\n                    return;\n                }\n                this.state.isSwipe = true;\n            }\n        }\n\n        e.preventDefault(); // stop any scrolling if we are currently swiping\n        this.emit(\"update\", { x: xDelta, y: yDelta }, this.state.metadata);\n    }\n\n    end(e: MouseEvent | TouchEvent) {\n        if (!this.state) {\n            return false;\n        } // ignore if we aren't currently dragging\n        let touch: MouseEvent | Touch | undefined = e instanceof MouseEvent ? e : undefined;\n        if (!(e instanceof MouseEvent)) {\n            for (let i = 0; i < e.changedTouches.length; ++i) {\n                const t = e.changedTouches[i];\n                if (t.identifier === this.state.identifier) {\n                    touch = t;\n                    break;\n                }\n            }\n        }\n        if (!touch) {\n            return false;\n        } // ignore if none of the touches are the one we're tracking\n\n        // then calculate the projected point we want to check\n        const velocity = this.state.velocity;\n        const totalDelta = touch.clientX - this.state.startTouch.x;\n        const recentDelta = touch.clientX - this.state.lastTouch.x;\n        let finalDelta = totalDelta;\n        // we only project a point out if the flick is in the direction of the swipe, otherwise we just use the touch position\n        if ((totalDelta >= 0 && recentDelta >= 0) || (totalDelta <= 0 && recentDelta <= 0)) {\n            finalDelta += velocity * 50; // project it 50ms out\n        }\n\n        // finally check if it's a swipe\n        if (this.threshold && this.threshold > 0 && Math.abs(finalDelta) > this.threshold) {\n            this.emit(\"end\", finalDelta < 0 ? \"left\" : \"right\", this.state.metadata);\n            this.after();\n            return true;\n        }\n        this.cancel();\n        return false;\n    }\n\n    cancel() {\n        if (!this.state) {\n            return;\n        }\n        this.emit(\"cancel\", this.state.metadata);\n        this.after();\n    }\n\n    after() {\n        delete this.state;\n    }\n\n    emit(event: keyof listeners, ...args: any[]) {\n        const listener = this.listeners[event] as ((...args: any[]) => void) | undefined;\n        if (listener) {\n            listener(...args);\n        }\n    }\n}\n","import { MediumLightboxCore } from \"../core\";\nimport { YamzPlugin, Classes } from \"../types\";\nimport withAlbum from \"../album/album\";\nimport \"./swipe.css\";\nimport SwipeDetector from \"./detector\";\n\nexport interface Swipeable {\n    swipeDetector: SwipeDetector;\n    applySwipeTransform: (offset: { x: number; y: number }, opts: SwipeOptions) => void;\n    onSwipeStart: (point: { x: number; y: number }, opts: SwipeOptions) => void;\n    onSwipeEnd: (direction: \"left\" | \"right\", opts: SwipeOptions) => void;\n    onSwipeCancel: (opts: SwipeOptions) => void;\n    afterSwipe: () => void;\n}\n\nexport interface SwipeOptions {\n    /** Describes how far users have to drag before it's recognized as a drag */\n    swipeThreshold?: number;\n    /** Describes how far the image can move visually in response to being dragged */\n    swipeResponseLimit?: number;\n    /** If true, desktop users can drag images using their mouse */\n    swipeOnDesktop?: boolean;\n}\n\n/** Augments the YAMZ instance to support swiping through albums on mobile */\nexport default function withSwipe<YamzType extends ReturnType<typeof withAlbum>>(_yamz: YamzType) {\n    const { defaultLightboxGenerator } = _yamz;\n    const yamz = _yamz as YamzPlugin<YamzType, Swipeable, SwipeOptions, SwipeOptions>;\n    // tslint:disable-next-line strict-type-predicates\n    if (typeof window === \"undefined\") {\n        return yamz;\n    }\n\n    yamz.options = {\n        swipeThreshold: window.innerWidth * 0.25,\n        swipeResponseLimit: window.innerWidth * 0.05,\n        swipeOnDesktop: false,\n        ...yamz.options,\n    };\n\n    // attach listeners to lightbox if we're displaying an album\n    yamz.defaultLightboxGenerator = function($copiedImg, opts, $original) {\n        const $lightbox = defaultLightboxGenerator.call(this, $copiedImg, opts, $original);\n\n        if (!opts.album) {\n            return $lightbox;\n        }\n\n        if (opts.swipeThreshold) {\n            yamz.swipeDetector.setThreshold(opts.swipeThreshold);\n        }\n\n        // normally we don't let mouse users swipe, but developers can enable it if they want\n        if (opts.swipeOnDesktop) {\n            $lightbox.addEventListener(\"mousedown\", e => {\n                e.preventDefault();\n                yamz.swipeDetector.start(e, opts);\n            });\n            $lightbox.addEventListener(\"mousemove\", e => {\n                e.preventDefault();\n                yamz.swipeDetector.move(e);\n            });\n            let justSwiped = 0;\n            $lightbox.addEventListener(\"mouseup\", e => {\n                e.preventDefault();\n                if (yamz.swipeDetector.state) {\n                    justSwiped = yamz.swipeDetector.state.isSwipe ? Date.now() : 0;\n                }\n                if (!yamz.swipeDetector.end(e)) {\n                    this.onSwipeCancel(opts);\n                }\n            });\n            $lightbox.addEventListener(\"click\", e => {\n                // we stop propagation here so that the lightbox doesn't close if we just swiped\n                if (Date.now() - justSwiped < 16) {\n                    e.stopImmediatePropagation();\n                }\n            });\n        }\n\n        // we always attach listeners for touch\n        $lightbox.addEventListener(\"touchstart\", e => {\n            yamz.swipeDetector.start(e, opts);\n        });\n        $lightbox.addEventListener(\"touchmove\", yamz.swipeDetector.move);\n        $lightbox.addEventListener(\"touchend\", yamz.swipeDetector.end);\n        $lightbox.addEventListener(\"touchcancel\", yamz.swipeDetector.cancel);\n\n        return $lightbox;\n    };\n\n    yamz.applySwipeTransform = function(touchOffset: { x: number; y: number }, opts: SwipeOptions) {\n        if (!this.active) {\n            return;\n        }\n        let offset = Math.abs(touchOffset.x);\n        let scale = 1;\n        if (opts.swipeResponseLimit) {\n            // use a sine function to slowly scale down\n            // sine wave is 3 long, because that gives a 45 degree angle at the start, so 1px touch movement = 1px image movement\n            const limit = opts.swipeResponseLimit * 1.5; // this is where we want the image to stop moving entirely\n            const progress = Math.abs(touchOffset.x) / opts.swipeResponseLimit;\n            const clampedProgress = Math.min(progress, 1.5);\n            const offsetScale = Math.sin((clampedProgress * Math.PI) / 3);\n            offset = opts.swipeResponseLimit * offsetScale;\n\n            // update the opacity if we're nearing the end\n            if (progress > 1) {\n                scale = Math.min(Math.max(1 - (progress - 1) * 0.01, 0.8), 1);\n            }\n\n            // maintain a very slight response to dragging further\n            const linearOffset = Math.abs(touchOffset.x) - Math.min(Math.abs(touchOffset.x), limit);\n            offset += linearOffset * 0.05;\n\n            if (touchOffset.x < 0) {\n                offset = -offset;\n            }\n        }\n\n        const $target = this.active.$lightbox.querySelector(\n            `.${Classes.IMG_WRAPPER}`\n        ) as HTMLElement | null;\n        if ($target) {\n            $target.style.transform = `translateX(${offset.toFixed(5)}px) scale(${scale.toFixed(\n                5\n            )})`;\n            $target.style.opacity = `${1 - (1 - scale) * 4}`;\n        }\n    };\n\n    yamz.onSwipeStart = function(point: { x: number; y: number }, opts: SwipeOptions) {\n        if (this.active) {\n            const $target = this.active.$lightbox.querySelector(`.${Classes.IMG_WRAPPER}`);\n            if ($target) {\n                $target.classList.add(`${Classes.IMG_WRAPPER}--swiping`);\n            }\n        }\n    };\n    yamz.onSwipeEnd = function(direction: \"left\" | \"right\", opts: SwipeOptions) {\n        if (this.active) {\n            const $btn =\n                direction === \"left\"\n                    ? this.active.$lightbox.querySelector(`.${Classes.ALBUM_NEXT}`)\n                    : this.active.$lightbox.querySelector(`.${Classes.ALBUM_PREV}`);\n            if ($btn) {\n                ($btn as HTMLElement).click();\n            }\n        }\n        this.afterSwipe();\n    };\n\n    yamz.onSwipeCancel = function(opts: SwipeOptions) {\n        this.applySwipeTransform({ x: 0, y: 0 }, opts);\n        this.afterSwipe();\n    };\n\n    yamz.afterSwipe = function() {\n        if (this.active) {\n            const $target = this.active.$lightbox.querySelector(`.${Classes.IMG_WRAPPER}`);\n            if ($target) {\n                $target.classList.remove(`${Classes.IMG_WRAPPER}--swiping`);\n            }\n        }\n    };\n\n    yamz.swipeDetector = new SwipeDetector({\n        start: yamz.onSwipeStart.bind(yamz),\n        update: yamz.applySwipeTransform.bind(yamz),\n        end: yamz.onSwipeEnd.bind(yamz),\n        cancel: yamz.onSwipeCancel.bind(yamz),\n    });\n\n    return yamz;\n}\n","import yamz from \"./core\";\nimport withCaption from \"./caption/caption\";\nimport withAlbum from \"./album/album\";\nimport withSwipe from \"./swipe/swipe\";\n\nexport default withSwipe(withAlbum(withCaption(yamz)));\n"],"names":["tslib_1.__assign"],"mappings":"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"}